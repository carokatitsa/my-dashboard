<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Coin Archive Pro</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --gold: #f1c40f; --text: #e0e0e0; --red: #e74c3c; --green: #2ecc71; --blue: #3498db; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 20px; margin: 0; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* –§–æ—Ä–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .admin-panel { background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid #333; margin-bottom: 30px; position: sticky; top: 10px; z-index: 100; }
        .inputs { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        input, textarea, select { background: #000; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 6px; width: 100%; box-sizing: border-box; }
        
        .btn-main { background: var(--gold); color: #000; border: none; padding: 15px; border-radius: 6px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        .btn-edit-mode { background: var(--blue); color: white; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –º–æ–Ω–µ—Ç—ã */
        .coin-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; }
        .coin-card { background: var(--card); border-radius: 12px; overflow: hidden; border: 1px solid #333; position: relative; display: flex; flex-direction: column; }
        .coin-card.sold { opacity: 0.6; filter: grayscale(0.4); }
        
        /* –°–µ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .photo-gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 5px; background: #000; padding: 5px; min-height: 150px; }
        .gallery-img { width: 100%; height: 120px; object-fit: cover; cursor: pointer; transition: 0.2s; border-radius: 4px; }
        .gallery-img:hover { opacity: 0.8; }

        .coin-info { padding: 15px; flex-grow: 1; }
        .coin-header { display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; color: var(--gold); margin-bottom: 10px; }
        .coin-price { color: #fff; }
        .coin-desc { font-size: 14px; color: #bbb; margin-bottom: 15px; min-height: 40px; }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; border-top: 1px solid #333; }
        .btn-act { padding: 8px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; font-size: 12px; }
        .btn-edit { background: #444; color: #fff; }
        .btn-status { background: #333; color: #aaa; }
        .del-badge { position: absolute; top: 5px; right: 5px; background: rgba(231,76,60,0.8); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; z-index: 5; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="formTitle">ü™ô Coin Archive: –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏</h1>

    <div class="admin-panel" id="adminPanel">
        <div class="inputs">
            <input type="text" id="coinNum" placeholder="–ù–æ–º–µ—Ä –º–æ–Ω–µ—Ç—ã">
            <input type="text" id="coinPrice" placeholder="–¶–µ–Ω–∞">
            <select id="coinStatus">
                <option value="available">–í –Ω–∞–ª–∏—á–∏–∏</option>
                <option value="sold">–ü—Ä–æ–¥–∞–Ω–æ</option>
            </select>
        </div>
        <textarea id="coinUrls" placeholder="–°—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–æ—Ç–æ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: –∞–≤–µ—Ä—Å, —Ä–µ–≤–µ—Ä—Å, –≥—É—Ä—Ç...)" rows="2"></textarea>
        <textarea id="coinDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ..." rows="2" style="margin-top:10px"></textarea>
        
        <button id="submitBtn" class="btn-main" onclick="handleSubmit()">–î–û–ë–ê–í–ò–¢–¨ –í –ë–ê–ó–£</button>
        <button id="cancelBtn" style="display:none; background:none; color:gray; border:none; width:100%; margin-top:5px; cursor:pointer" onclick="resetForm()">–û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</button>
    </div>

    <div id="coinGrid" class="coin-grid"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA3QRDLzkS9-NnupC5KN65fMv1j39ZovsI",
        authDomain: "my-dashboard-dc67a.firebaseapp.com",
        projectId: "my-dashboard-dc67a",
        storageBucket: "my-dashboard-dc67a.firebasestorage.app",
        messagingSenderId: "710702954120",
        appId: "1:710702954120:web:90e5e9a158f31d9728913d",
        measurementId: "G-47TDJGNE9F"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let editId = null; // ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –º–æ–Ω–µ—Ç—ã

    async function handleSubmit() {
        const data = {
            number: document.getElementById('coinNum').value,
            price: document.getElementById('coinPrice').value,
            status: document.getElementById('coinStatus').value,
            // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å—Å—ã–ª–æ–∫ –≤ –º–∞—Å—Å–∏–≤, —É–±–∏—Ä–∞—è –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
            images: document.getElementById('coinUrls').value.split(',').map(s => s.trim()).filter(s => s !== ""),
            description: document.getElementById('coinDesc').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        if(!data.number || data.images.length === 0) return alert("–ù—É–∂–µ–Ω –Ω–æ–º–µ—Ä –∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Å—ã–ª–∫–∞!");

        if (editId) {
            await db.collection("my_coins").doc(editId).update(data);
            editId = null;
        } else {
            data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            await db.collection("my_coins").add(data);
        }
        resetForm();
    }

    function startEdit(id) {
        const coin = window.allCoins.find(c => c.id === id);
        if (!coin) return;

        editId = id;
        document.getElementById('coinNum').value = coin.number;
        document.getElementById('coinPrice').value = coin.price;
        document.getElementById('coinStatus').value = coin.status;
        document.getElementById('coinUrls').value = coin.images ? coin.images.join(', ') : (coin.imageUrl || "");
        document.getElementById('coinDesc').value = coin.description;

        document.getElementById('submitBtn').innerText = "–°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø";
        document.getElementById('submitBtn').classList.add('btn-edit-mode');
        document.getElementById('cancelBtn').style.display = "block";
        window.scrollTo(0, 0);
    }

    function resetForm() {
        editId = null;
        ['coinNum', 'coinPrice', 'coinUrls', 'coinDesc'].forEach(id => document.getElementById(id).value = "");
        document.getElementById('submitBtn').innerText = "–î–û–ë–ê–í–ò–¢–¨ –í –ë–ê–ó–£";
        document.getElementById('submitBtn').classList.remove('btn-edit-mode');
        document.getElementById('cancelBtn').style.display = "none";
    }

    db.collection("my_coins").orderBy("updatedAt", "desc").onSnapshot(snapshot => {
        window.allCoins = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
        render();
    });

    function render() {
        const grid = document.getElementById('coinGrid');
        grid.innerHTML = "";

        window.allCoins.forEach(coin => {
            const isSold = coin.status === 'sold';
            const photos = coin.images || [coin.imageUrl]; // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π

            let photoHtml = '';
            photos.forEach(url => {
                if(url) photoHtml += `<img src="${url}" class="gallery-img" onclick="window.open('${url}')">`;
            });

            grid.innerHTML += `
                <div class="coin-card ${isSold ? 'sold' : ''}">
                    <button class="del-badge" onclick="deleteCoin('${coin.id}')">‚úï</button>
                    <div class="photo-gallery">${photoHtml}</div>
                    <div class="coin-info">
                        <div class="coin-header">
                            <span># ${coin.number}</span>
                            <span class="coin-price">${coin.price}</span>
                        </div>
                        <div class="coin-desc">${coin.description}</div>
                    </div>
                    <div class="actions">
                        <button class="btn-act btn-edit" onclick="startEdit('${coin.id}')">–ò–ó–ú–ï–ù–ò–¢–¨</button>
                        <button class="btn-act btn-status" onclick="toggleStatus('${coin.id}', '${coin.status}')">
                            ${isSold ? '–í –ù–ê–õ–ò–ß–ò–ï' : '–í –ü–†–û–î–ê–ù–û'}
                        </button>
                    </div>
                </div>
            `;
        });
    }

    async function toggleStatus(id, current) {
        await db.collection("my_coins").doc(id).update({ status: current === 'available' ? 'sold' : 'available' });
    }

    async function deleteCoin(id) {
        if(confirm("–£–¥–∞–ª–∏—Ç—å –º–æ–Ω–µ—Ç—É?")) await db.collection("my_coins").doc(id).delete();
    }
</script>

</body>
</html>
